{
  "name": "System_Alert_Service",
  "nodes": [
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        0,
        96
      ],
      "id": "ad9c2431-6c70-4774-9edf-35c427c81679",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "fromEmail": "trainingcqy@gmail.com",
        "toEmail": "trainingcqy@gmail.com",
        "subject": "={{ $json.source || $execution?.lastNodeExecuted || 'System' }} 故障",
        "html": "=<div style=\"font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: #ffffff; color: #202124; padding: 20px 0;\">\n    \n    <div style=\"padding: 32px;\">\n      \n      <div style=\"margin-bottom: 32px;\">\n        <h1 style=\"margin: 0; font-size: 22px; font-weight: 400; color: #d93025; letter-spacing: -0.5px;\">System Alert Triggered</h1>\n      </div>\n      <div style=\"margin-bottom: 24px;\">\n        <div style=\"font-size: 14px; font-weight: 700; color: #202124;\">\n          {{ new Date().toLocaleString('zh-CN', {timeZone: 'Asia/Shanghai'}) }}\n        </div>\n      </div>\n\n      <div style=\"margin-bottom: 24px;\">\n        <div style=\"font-size: 11px; font-weight: 800; color: #5f6368; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.8px;\">Source</div>\n        <div style=\"font-size: 14px; font-weight: 600; color: #202124;\">\n          {{ $json.source || $execution.lastNodeExecuted }}\n        </div>\n      </div>\n\n      <div style=\"margin-bottom: 32px;\">\n        <div style=\"font-size: 11px; font-weight: 800; color: #5f6368; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.8px;\">Error</div>\n        <div style=\"font-size: 14px; font-weight: 600; color: #202124; line-height: 1.6;\">\n          {{ $json.error_message || $execution.error.message }}\n        </div>\n      </div>\n\n      <div style=\"margin-bottom: 24px;\">\n        <div style=\"font-size: 11px; font-weight: 800; color: #5f6368; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.8px;\">Target</div>\n        <div style=\"font-size: 14px; font-weight: 600; color: #202124; font-family: 'Menlo', monospace; word-break: break-all;\">\n          <a href=\"{{ $json.url }}\" style=\"color: #202124; text-decoration: none;\">\n          {{ $json.url }}\n            </a>\n        </div>\n      </div>\n\n      <div style=\"text-align: center;\">\n        <a href=\"http://localhost:5678\" style=\"background-color: #1a73e8; color: #ffffff; padding: 10px 24px; border-radius: 4px; text-decoration: none; font-size: 14px; font-weight: 500; display: inline-block;\">\n          Open Console\n        </a>\n      </div>\n\n    </div>\n  </div>\n  \n  <div style=\"text-align: center; margin-top: 24px; font-size: 12px; color: #70757a;\">\n    &copy; 2026 TechNews Intelligence\n  </div>\n</div>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        224,
        -144
      ],
      "id": "67ddf4de-8dfb-42c7-82a9-7f013cb41fc6",
      "name": "Send email",
      "webhookId": "0cf5b080-1809-4958-b12f-bfdfa2137713",
      "credentials": {
        "smtp": {
          "id": "sWp9jBi4W6DtqvZL",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        0,
        -192
      ],
      "id": "970050d7-89ce-4a6a-ba66-c68234ea6226",
      "name": "Error Trigger"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "system_logs",
          "mode": "list",
          "cachedResultName": "system_logs"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "event_type": "ERROR",
            "source": "={{ $json.source || $execution?.lastNodeExecuted || 'Alert' }}",
            "target_url": "={{ $json.url || null }}",
            "message": "={{ $json.error_message || $execution?.error?.message || 'Unknown error' }}",
            "created_at": "={{ new Date().toISOString() }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "event_type",
              "displayName": "event_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "source",
              "displayName": "source",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "target_url",
              "displayName": "target_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        224,
        48
      ],
      "id": "ac892594-4332-4f83-81e8-9fc99a80bb22",
      "name": "Insert rows in system log",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "16OTc6Oi6SG8mPOF",
          "name": "Postgres account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Insert rows in system log",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Trigger": {
      "main": [
        [
          {
            "node": "Insert rows in system log",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in system log": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "a23c718c-4928-4e0c-8f6c-79e26a6bd0ee",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "254b471fa50f95c8bdeb3b168acb87704b701a4e796abd09a694ec3e0a128433"
  },
  "id": "r4mRi5yxtJsH06JOp42lk",
  "tags": []
}